<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å°ç†Šè²“vså…¶ä»–ç‰©ç¨® - ç‰©ç¨®æ¯”è¼ƒ</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;500;700;900&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="../../assets/css/styles.css">
<script id="tailwind-config">
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#ec6d13",
                    "background-light": "#f8f7f6",
                    "background-dark": "#221810",
                },
                fontFamily: {
                    "display": ["Epilogue"]
                },
                borderRadius: { "DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px" },
                animation: {
                    'fade-in': 'fadeIn 0.5s ease-in-out',
                    'slide-up': 'slideUp 0.3s ease-out',
                }
            },
        },
    }
</script>
<style>
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    body {
        min-height: max(884px, 100dvh);
    }
    .tab-content > div {
        display: none;
    }
    .tab-content > div.active {
        display: block;
        animation: fade-in 0.3s ease-in-out;
    }
    .chart-bar {
        transition: width 0.8s ease-out;
    }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-background-dark dark:text-background-light">
<div class="relative flex min-h-screen w-full flex-col justify-between overflow-x-hidden">
<div class="flex-grow">

<!-- Header -->
<header class="sticky top-0 z-10 flex items-center justify-between bg-background-light/80 p-4 pb-3 backdrop-blur-sm dark:bg-background-dark/80">
<button onclick="history.back()" class="text-background-dark dark:text-background-light hover:text-primary transition-colors">
<svg fill="currentColor" height="24" viewBox="0 0 256 256" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z"></path>
</svg>
</button>
<h1 class="text-lg font-bold">ç‰©ç¨®æ¯”è¼ƒ</h1>
<div class="w-6"></div>
</header>

<main class="p-4">
    <!-- è¼‰å…¥æç¤º -->
    <div id="loading" class="text-center py-8">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
        <p class="mt-2 text-sm">è¼‰å…¥ä¸­...</p>
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <div id="main-content" class="hidden">
        <!-- Tab æŒ‰éˆ• -->
        <div class="flex justify-around mb-6 overflow-x-auto">
            <button class="tab-btn active px-3 py-2 rounded-lg bg-primary text-white font-semibold transition-all duration-200 hover:bg-primary/90 text-sm whitespace-nowrap" data-tab="overview">ç¸½è¦½</button>
            <button class="tab-btn px-3 py-2 rounded-lg text-background-dark dark:text-background-light font-semibold hover:bg-primary/10 transition-all duration-200 text-sm whitespace-nowrap" data-tab="physical">é«”å‹</button>
            <button class="tab-btn px-3 py-2 rounded-lg text-background-dark dark:text-background-light font-semibold hover:bg-primary/10 transition-all duration-200 text-sm whitespace-nowrap" data-tab="habitat">æ£²æ¯åœ°</button>
            <button class="tab-btn px-3 py-2 rounded-lg text-background-dark dark:text-background-light font-semibold hover:bg-primary/10 transition-all duration-200 text-sm whitespace-nowrap" data-tab="diet">é£²é£Ÿ</button>
        </div>

        <!-- Tab å…§å®¹ -->
        <div class="tab-content">
            <!-- ç¸½è¦½æ¨™ç±¤ -->
            <div id="overview" class="active">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold mb-4 text-center text-primary">å°ç†Šè²“ vs å…¶ä»–å‹•ç‰©</h2>
                    <p class="text-center text-background-dark/70 dark:text-background-light/70 mb-6">
                        æ¢ç´¢å°ç†Šè²“èˆ‡å¤§ç†Šè²“ã€æµ£ç†Šã€ç‹ç‹¸ä¹‹é–“çš„ç•°åŒ
                    </p>
                </div>

                <!-- å‹•ç‰©å¡ç‰‡ç¶²æ ¼ -->
                <div id="animals-grid" class="grid grid-cols-2 gap-4 mb-6">
                    <!-- å‹•ç‰©å¡ç‰‡æœƒå‹•æ…‹æ’å…¥ -->
                </div>

                <!-- é‡é»æ¯”è¼ƒ -->
                <div class="bg-white dark:bg-zinc-800/20 rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4">ğŸ¯ é‡é»æ¯”è¼ƒ</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">é«”å‹æœ€å¤§ï¼š</span>
                            <span id="largest-animal" class="text-primary font-bold"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium">æ”€çˆ¬æœ€ä½³ï¼š</span>
                            <span id="best-climber" class="text-primary font-bold"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium">æœ€ç€•å±ï¼š</span>
                            <span id="most-endangered" class="text-red-600 font-bold"></span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium">æœ€é›œé£Ÿï¼š</span>
                            <span id="most-omnivorous" class="text-green-600 font-bold"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é«”å‹æ¨™ç±¤ -->
            <div id="physical">
                <section class="rounded-xl overflow-hidden bg-white dark:bg-zinc-800/20 mb-6 shadow-lg">
                    <div class="p-6">
                        <h2 class="text-xl font-bold mb-4 text-primary">é«”å‹æ¯”è¼ƒ</h2>

                        <!-- é‡é‡æ¯”è¼ƒ -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-3">é«”é‡ (å…¬æ–¤)</h3>
                            <div id="weight-chart" class="space-y-3">
                                <!-- é‡é‡åœ–è¡¨æœƒå‹•æ…‹æ’å…¥ -->
                            </div>
                        </div>

                        <!-- é«”é•·æ¯”è¼ƒ -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-3">èº«é•· (å…¬åˆ†)</h3>
                            <div id="length-chart" class="space-y-3">
                                <!-- é«”é•·åœ–è¡¨æœƒå‹•æ…‹æ’å…¥ -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- æ£²æ¯åœ°æ¨™ç±¤ -->
            <div id="habitat">
                <section class="rounded-xl overflow-hidden bg-white dark:bg-zinc-800/20 mb-6 shadow-lg">
                    <div class="p-6">
                        <h2 class="text-xl font-bold mb-4 text-primary">æ£²æ¯åœ°æ¯”è¼ƒ</h2>
                        <div id="habitat-comparison" class="space-y-4">
                            <!-- æ£²æ¯åœ°æ¯”è¼ƒæœƒå‹•æ…‹æ’å…¥ -->
                        </div>
                    </div>
                </section>
            </div>

            <!-- é£²é£Ÿæ¨™ç±¤ -->
            <div id="diet">
                <section class="rounded-xl overflow-hidden bg-white dark:bg-zinc-800/20 mb-6 shadow-lg">
                    <div class="p-6">
                        <h2 class="text-xl font-bold mb-4 text-primary">é£²é£Ÿç¿’æ€§æ¯”è¼ƒ</h2>
                        <div id="diet-comparison" class="space-y-6">
                            <!-- é£²é£Ÿæ¯”è¼ƒæœƒå‹•æ…‹æ’å…¥ -->
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- è¶£å‘³çŸ¥è­˜ -->
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-6">
            <h3 class="text-lg font-bold mb-4 text-blue-800 dark:text-blue-300">ğŸ¤” ä½ çŸ¥é“å—ï¼Ÿ</h3>
            <div id="fun-facts" class="space-y-3">
                <!-- è¶£å‘³çŸ¥è­˜æœƒå‹•æ…‹æ’å…¥ -->
            </div>
        </div>
    </div>
</main>
</div>

<div id="navbar-container"></div>
</div>

<script>
// Tab åˆ‡æ›åŠŸèƒ½
const tabButtons = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content > div');

tabButtons.forEach(button => {
    button.addEventListener('click', () => {
        // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
        tabButtons.forEach(btn => {
            btn.classList.remove('active', 'bg-primary', 'text-white');
            btn.classList.add('text-background-dark', 'dark:text-background-light');
        });
        tabContents.forEach(content => content.classList.remove('active'));

        // è¨­ç½®ç•¶å‰æŒ‰éˆ•ç‚º active
        button.classList.add('active', 'bg-primary', 'text-white');
        button.classList.remove('text-background-dark', 'dark:text-background-light');

        // é¡¯ç¤ºå°æ‡‰å…§å®¹
        const targetTab = button.getAttribute('data-tab');
        document.getElementById(targetTab).classList.add('active');
    });
});

let animalsData = null;

// è¼‰å…¥å‹•ç‰©è³‡æ–™
async function loadAnimalsData() {
    try {
        const response = await fetch('../../data/animals.json');
        animalsData = await response.json();

        renderOverview();
        renderPhysicalComparison();
        renderHabitatComparison();
        renderDietComparison();

        // éš±è—è¼‰å…¥æç¤ºï¼Œé¡¯ç¤ºä¸»è¦å…§å®¹
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');

    } catch (error) {
        console.error('è¼‰å…¥æ•¸æ“šå¤±æ•—:', error);
        document.getElementById('loading').innerHTML = '<p class="text-red-500">è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢</p>';
    }
}

function renderOverview() {
    const animalsGrid = document.getElementById('animals-grid');
    const animals = animalsData.animals;

    animalsGrid.innerHTML = '';

    animals.forEach(animal => {
        const card = document.createElement('div');
        card.className = 'bg-white dark:bg-zinc-800/20 rounded-lg p-4 shadow-lg text-center';

        // å‹•ç‰©åœ–ç‰‡æ˜ å°„
        const imageMap = {
            'å°ç†Šè²“': '../images/red-panda.jpg',
            'å¤§ç†Šè²“': '../images/panda.jpg',
            'æµ£ç†Š': '../images/raccoon.jpg',
            'ç‹ç‹¸': '../images/fox.jpg'
        };

        card.innerHTML = `
            <img src="${imageMap[animal.name] || '../images/red-panda.jpg'}" alt="${animal.name}" class="w-full h-24 object-cover rounded-lg mb-3">
            <h3 class="font-bold text-lg mb-1">${animal.name}</h3>
            <p class="text-sm text-background-dark/70 dark:text-background-light/70 mb-2">${animal.scientific_name}</p>
            <div class="text-xs space-y-1">
                <p><span class="font-medium">é‡é‡:</span> ${animal.physical_characteristics.weight_kg}kg</p>
                <p><span class="font-medium">æ£²æ¯åœ°:</span> ${animal.habitat.environment}</p>
                <p><span class="font-medium">ä¿è‚²:</span> ${animal.conservation_status}</p>
            </div>
        `;

        animalsGrid.appendChild(card);
    });

    // å¡«å…¥æ¯”è¼ƒè³‡æ–™
    const summary = animalsData.comparison_summary;
    document.getElementById('largest-animal').textContent = summary.size_order[0];
    document.getElementById('best-climber').textContent = summary.climbing_ability_ranking[0];
    document.getElementById('most-endangered').textContent = summary.conservation_concern.highest_risk;
    document.getElementById('most-omnivorous').textContent = summary.diet_specialization.most_generalized;
}

function renderPhysicalComparison() {
    const weightChart = document.getElementById('weight-chart');
    const lengthChart = document.getElementById('length-chart');
    const animals = animalsData.animals;

    // é‡é‡æ¯”è¼ƒ
    weightChart.innerHTML = '';
    const maxWeight = Math.max(...animals.map(a => parseFloat(a.physical_characteristics.weight_kg.split('-')[1] || a.physical_characteristics.weight_kg)));

    animals.forEach(animal => {
        const weight = parseFloat(animal.physical_characteristics.weight_kg.split('-')[1] || animal.physical_characteristics.weight_kg);
        const percentage = (weight / maxWeight) * 100;

        const bar = document.createElement('div');
        bar.className = 'flex items-center space-x-3';
        bar.innerHTML = `
            <div class="w-16 text-sm font-medium">${animal.name}</div>
            <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-4 relative">
                <div class="chart-bar bg-gradient-to-r from-primary to-orange-600 h-4 rounded-full" style="width: 0%"></div>
            </div>
            <div class="w-16 text-sm text-right">${animal.physical_characteristics.weight_kg}kg</div>
        `;
        weightChart.appendChild(bar);

        // å‹•ç•«æ•ˆæœ
        setTimeout(() => {
            bar.querySelector('.chart-bar').style.width = `${percentage}%`;
        }, 200);
    });

    // é«”é•·æ¯”è¼ƒ
    lengthChart.innerHTML = '';
    const maxLength = Math.max(...animals.map(a => parseFloat(a.physical_characteristics.body_length_cm.split('-')[1] || a.physical_characteristics.body_length_cm)));

    animals.forEach(animal => {
        const length = parseFloat(animal.physical_characteristics.body_length_cm.split('-')[1] || animal.physical_characteristics.body_length_cm);
        const percentage = (length / maxLength) * 100;

        const bar = document.createElement('div');
        bar.className = 'flex items-center space-x-3';
        bar.innerHTML = `
            <div class="w-16 text-sm font-medium">${animal.name}</div>
            <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-4 relative">
                <div class="chart-bar bg-gradient-to-r from-green-500 to-emerald-600 h-4 rounded-full" style="width: 0%"></div>
            </div>
            <div class="w-16 text-sm text-right">${animal.physical_characteristics.body_length_cm}cm</div>
        `;
        lengthChart.appendChild(bar);

        // å‹•ç•«æ•ˆæœ
        setTimeout(() => {
            bar.querySelector('.chart-bar').style.width = `${percentage}%`;
        }, 400);
    });
}

function renderHabitatComparison() {
    const habitatComparison = document.getElementById('habitat-comparison');
    const animals = animalsData.animals;

    habitatComparison.innerHTML = '';

    animals.forEach(animal => {
        const card = document.createElement('div');
        card.className = 'bg-gradient-to-r from-blue-50 to-green-50 dark:from-blue-900/20 dark:to-green-900/20 rounded-lg p-4';
        card.innerHTML = `
            <h3 class="font-bold text-lg mb-2">${animal.name}</h3>
            <div class="grid grid-cols-2 gap-2 text-sm">
                <div><span class="font-medium">åˆ†ä½ˆ:</span> ${animal.habitat.geographic_range}</div>
                <div><span class="font-medium">ç’°å¢ƒ:</span> ${animal.habitat.environment}</div>
                <div><span class="font-medium">æµ·æ‹”:</span> ${animal.habitat.altitude_m}m</div>
                <div><span class="font-medium">æ°£å€™:</span> ${animal.habitat.climate}</div>
            </div>
        `;
        habitatComparison.appendChild(card);
    });
}

function renderDietComparison() {
    const dietComparison = document.getElementById('diet-comparison');
    const animals = animalsData.animals;

    dietComparison.innerHTML = '';

    animals.forEach(animal => {
        const card = document.createElement('div');
        card.className = 'bg-white dark:bg-zinc-800/20 rounded-lg p-4 border border-gray-200 dark:border-gray-700';

        let dietDetails = '';
        if (animal.diet.food_percentage) {
            dietDetails = Object.entries(animal.diet.food_percentage)
                .map(([food, percentage]) => `${food}: ${percentage}%`)
                .join(', ');
        }

        card.innerHTML = `
            <h3 class="font-bold text-lg mb-3">${animal.name}</h3>
            <div class="space-y-2 text-sm">
                <p><span class="font-medium">ä¸»é£Ÿ:</span> ${animal.diet.primary_food}</p>
                <p><span class="font-medium">é¡å‹:</span> ${animal.diet.diet_type}</p>
                ${dietDetails ? `<p><span class="font-medium">æ¯”ä¾‹:</span> ${dietDetails}</p>` : ''}
            </div>
        `;
        dietComparison.appendChild(card);
    });
}

function renderFunFacts() {
    const funFacts = document.getElementById('fun-facts');
    const animals = animalsData.animals;

    funFacts.innerHTML = '';

    // æ”¶é›†æ‰€æœ‰æœ‰è¶£äº‹å¯¦
    const allFacts = [];
    animals.forEach(animal => {
        if (animal.interesting_facts) {
            animal.interesting_facts.forEach(fact => {
                allFacts.push(`${animal.name}ï¼š${fact}`);
            });
        }
    });

    // éš¨æ©Ÿé¸æ“‡3å€‹äº‹å¯¦
    const selectedFacts = allFacts.sort(() => 0.5 - Math.random()).slice(0, 3);

    selectedFacts.forEach(fact => {
        const factElement = document.createElement('p');
        factElement.className = 'text-sm text-blue-800 dark:text-blue-300';
        factElement.textContent = fact;
        funFacts.appendChild(factElement);
    });
}

// é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
document.addEventListener('DOMContentLoaded', async () => {
    await loadAnimalsData();
    renderFunFacts();
});
</script>

<script src="../assets/js/common.js"></script>
<script src="assets/js/navbar.js"></script>
</body>
</html>